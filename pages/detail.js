import axios from "axios";
import Head from "next/head";
import { useRouter } from "next/router";
import React, { useEffect, useState } from "react";
import { FcSearch } from "react-icons/fc";
import MiniCompoent from "./components/miniCompoent";
import urlImg from "../public/logo.png";
import Image from "next/image";
import dayjs from "dayjs";
import AutoCompleteComponent from "./components/AutoComplete";
import { Chip, CircularProgress } from "@mui/material";
import Top50Component from "./components/Top50Component";
import News from "./components/News";
function Detail() {
  const time = new Date();
  const date = time.getDate();
  const month = time.getMonth() + 1;
  const curMonthYear = date + "-" + month + "-" + time.getFullYear();
  const router = useRouter();
  const [infor, setInfor] = useState();
  const [loading, setLoading] = useState(true);
  const {
    query: { id },
  } = router;
  useEffect(() => {
    setLoading(true);
    if (id) {
      axios
        .get("http://localhost:8000/phone-numbers/detail/" + id, {
          headers: { authorization: "spambl0ckerAuthorization2k1rbyp0wer" },
        })
        .then((data) => {
          setInfor(data.data.result);
          setLoading(false);
        });
    }
  }, [id]);
  return (
    <>
      <Head>
        <title>CheckCallSpammer</title>
        <meta name="description" content="Generated by create next app" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <link
          rel="icon"
          href={
            "https://www.callspamblocker.online/_next/image?url=%2F_next%2Fstatic%2Fmedia%2Flogo.272f7cfe.png&w=384&q=75"
          }
        />
      </Head>
      <main className="relative">
        <div className="w-100 md:pl-[10px] pt-[2px] flex flex-row mx-a  justify-between h-[62px] bg-[#4BE1BA]">
          <Image
            alt="logo"
            width={60}
            height={40}
            onClick={() => {
              router.push({
                pathname: "/",
              });
            }}
            src={urlImg}
            className="my-auto md:block hidden cursor-pointer  "
          />

          <div className=" rounded-[6px]  md:w-[500px] w-[300px] mx-auto mt-[1px]">
            <AutoCompleteComponent />
          </div>
        </div>
        <p className=" font-bold md:text-[50px] text-[25px] text-center text-[#221f49] ">
          About this number
        </p>
        {loading === false ? (
          <div>
            <div className="md:w-full w-[80%] mx-auto h-[200x]   p-[15px] mt-[20px] rounded-2xl bg-[#c1c1c1]">
              <p className="md:text-[40px] text-[20px] text-[#696969] font-semibold">
                The number phone is{" "}
                <a className="font-bold text-[#221f49] underline">
                  {infor.phoneNumber}
                </a>
              </p>
              <p className="md:text-[25px] text-[12px]">
                This phone number is provided by{" "}
                <a className="underline font-bold">{infor.name}</a> and is a
                phone number in{" "}
                <a className=" text-[red] font-bold">Viet Nam</a> with the code
                is <Chip label={"+84"} color="info" size="small" />
              </p>
            </div>
            <div className="md:w-full w-[80%] mx-auto h-[200x] flex md:flex-row flex-col p-[15px] md:justify-between mt-[20px] rounded-2xl bg-[#c1c1c1]">
              <MiniCompoent
                types="information"
                header="Today"
                title={
                  infor.searchTracked[infor.searchTracked.length - 1]
                    .numberSearch
                }
                detail={"Searches"}
              />
              <hr className="md:visible" />
              <MiniCompoent
                types="information"
                header="Yesterday"
                title={
                  infor.searchTracked.length > 2
                    ? infor.searchTracked[infor.searchTracked.length - 2]
                        .numberSearch
                    : 0
                }
                detail={"Searches"}
              />
              <hr className="md:visible" />
              <MiniCompoent
                types="information"
                header="Total"
                title={infor.searchTracked.reduce((prev, cur) => {
                  return cur.numberSearch + prev;
                }, 0)}
                detail={"Searches"}
              />
              <hr className="md:visible" />
              <MiniCompoent
                types="information"
                title={
                  <Chip
                    variant="filled"
                    color={
                      infor.status === "unknown"
                        ? "secondary"
                        : infor.status === "spammer"
                        ? "error"
                        : "primary"
                    }
                    size={"50"}
                    className="capitalize "
                    style={{ marginBottom: "auto", marginTop: "auto" }}
                    label={infor.status}
                  />
                }
                color={
                  infor.status === "unknown"
                    ? "#008080"
                    : infor.status === "spammer"
                    ? "red"
                    : "#008080"
                }
                detail={
                  infor.status === "unknown"
                    ? "Safe!"
                    : infor.status === "spammer"
                    ? "Dangerous!"
                    : "Safe!"
                }
                header={"Status"}
              />
              <hr className="md:visible" />
              <MiniCompoent
                types="information"
                header={"Reports"}
                title={infor.reportList.length}
                color="#1e2746"
                colorTitle="white"
                detail={"Times"}
              />
            </div>

            <p className="font-medium md:text-[50px] text-[25px] text-center text-[#221f49]  pt-[25px]">
              Report
            </p>
            <div className="flex flex-row flex-wrap justify-center">
              {infor.reportList.map((value, index) => (
                <div key={index}>
                  <MiniCompoent
                    types="comments"
                    number={value.title}
                    hourse={dayjs(value.reportDate).format("DD-MM-YYYY")}
                    comment={value.content}
                    key={index}
                  />
                </div>
              ))}
            </div>
          </div>
        ) : (
          <div className="text-center">
            <CircularProgress />
          </div>
        )}
        <p className="font-medium md:text-[50px] text-[25px] text-center text-[#221f49]  pt-[25px]">
          The suggest phone
        </p>
        <div className="flex flex-row flex-wrap justify-center">
          <Top50Component />
        </div>
        <p className="font-medium md:text-[50px] text-[25px] text-center text-[#221f49]  pt-[25px]">
          The News
        </p>
        <div className="flex flex-row flex-wrap justify-center">
          <News />
        </div>
      </main>
      <MiniCompoent types="footer" />
    </>
  );
}

export default Detail;
